# 概要

## 副作用のエンコーディング

Leanは純粋な関数型言語です。
これは、変更可能な変数、ログ出力、例外などの副作用を含まないことを意味します。
しかしながら、ほとんどの副作用は、関数と帰納型または構造体を組み合わせて_エンコード_することができます。
例えば、変更可能な状態は初期状態から最終状態と結果のペアへの関数としてエンコードされ、例外は成功した終了とエラーのためのコンストラクタを持つ帰納型としてエンコードできます。

エンコードされた副作用のそれぞれの集合は型です。
その結果、プログラムがこれらのエンコードされた副作用を使用する場合、これはその型に明らかになります。
関数型プログラミングとは、プログラムが副作用を使用できないという意味ではなく、単に使用する副作用について*正直である*ことが求められます。
Leanの型シグネチャは、関数が期待する引数の型と返す結果の型だけでなく、使用する可能性のある副作用も記述します。

## モナド型クラス

どこでも副作用を許容する言語で、純粋な関数型プログラムを書くことは可能です。
たとえば、`2 + 3`は全く副作用のない有効なPythonプログラムです。
同様に、副作用を持つプログラムを組み合わせる場合、副作用が発生する順序を指定する方法が必要です。
結局のところ、変数を変更する前後で例外が投げられるかどうかは重要です。

型クラス`Monad`は、これら二つの重要な特性を捉えます。
それには二つのメソッドがあります：`pure`は副作用のないプログラムを表し、`bind`は副作用を持つプログラムを順序づけます。
`Monad`のインスタンスに対する契約は、`bind`と`pure`が純粋な計算と順序づけを実際に捉えることを保証します。

## モナド用の`do`表記

`do`表記は`IO`に限定されることなく、どんなモナドに対しても動作します。
これにより、モナドを使用するプログラムは、一連のステートメントの後に他のステートメントが続く、文指向言語を思わせるスタイルで書くことができます。
さらに、`do`表記は、入れ子になったアクションなどの多くの便利な省略形を可能にします。
`do`で書かれたプログラムは、裏で`>>=`の適用に変換されます。

## カスタムモナド

異なる言語は異なるセットの副作用を提供します。
ほとんどの言語は変更可能な変数とファイルのI/Oを特徴としていますが、全てが例外のような機能を持っているわけではありません。
他の言語は、Iconの検索ベースのプログラム実行、SchemeやRubyの継続、そしてCommon Lispの再開可能な例外のような、珍しいまたは固有の効果を提供します。
モナドを使って副作用をエンコードする利点は、プログラムが言語によって提供される効果のセットに制限されないことです。
Leanは、任意のモナドでのプログラミングを便利にするように設計されているため、プログラマーは任意のアプリケーションに意味のある副作用のセットを自由に選択することができます。

## `IO`モナド

実世界に影響を与えることのできるプログラムはLeanで`IO`アクションとして記述されます。
`IO`は多くのモナドの中のひとつです。
`IO`モナドは状態と例外をエンコードし、状態は世界の状態を追跡するために、例外は失敗と回復をモデリングするために使用されます。