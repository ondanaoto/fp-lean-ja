Lean（リーン）は、依存型理論に基づいたMicrosoft Researchによって開発された対話型の定理証明器です。
依存型理論は、プログラムと証明の世界を統合します。したがって、Leanはプログラミング言語でもあります。
Leanはその二重性を真剣に受け止め、一般目的のプログラミング言語として使用に適したように設計されています。Leanは自身の中でさえ実装されています。
この本は、Leanでのプログラミングについてです。

プログラミング言語として見た場合、Leanは厳格な純粋関数型言語で、依存型を持っています。
Leanを使ってプログラムを学ぶことの大きな部分は、これらの特徴がプログラムの書き方にどのように影響するかを学び、関数型プログラマーのように考える方法を理解することです。
_厳格性_は、Leanにおける関数呼び出しが、ほとんどの言語と同様に動作することを意味します：引数は関数の本体が実行される前に完全に計算されます。
_純粋性_とは、Leanプログラムが、メモリ位置を変更したり、メールを送信したり、ファイルを削除したりするような副作用を持たないということです。プログラムの型がそう言わない限り、それは不可能です。
Leanは_関数型_言語であるという意味では、関数が他のどのような値と同じく第一級の値であり、実行モデルが数学的表現の評価に触発されているということです。
_依存型_は、Leanのもっとも珍しい特徴であり、型を言語の第一級の一部にし、型にプログラムを含ませたり、プログラムで型を計算させたりすることを可能にします。

この本は、関数型プログラム言語をこれまでに使ったことがなくても、Leanを学びたいと思っているプログラマーのために用意されています。
Haskell、OCaml、F#のような関数型言語に精通している必要はありません。
一方で、この本はループや関数、データ構造のような、ほとんどのプログラミング言語に共通の概念についての知識を前提としています。
この本は関数型プログラミングにおける良い最初の本を意図していますが、プログラミング全般についての最初の本としては適していません。

証明アシスタントとしてLeanを使用している数学者の中には、いずれカスタム証明自動化ツールを書く必要が生じる方もいるでしょう。
この本はそのような方々のためにもあります。
これらのツールがより洗練されるにつれ、それらは関数型言語内のプログラムに似てきますが、ほとんどの実践数学者はPythonやMathematicaのような言語で訓練されています。
この本はそのギャップを埋める助けとなり、より多くの数学者に維持可能でわかりやすい証明自動化ツールを書く力を与えることができます。

この本は前から順に読むことを意図しています。
概念は一つずつ紹介され、後のセクションは前のセクションに詳しいことが前提です。
時には、後の章で早期に簡単に扱われたトピックについて深く掘り下げられる場合があります。
本書のいくつかのセクションには練習問題が含まれています。
それらを行うことで、セクションの理解を固めることができます。
また、本を読みながらLeanを探索し、学んだことを新しい方法で活用することも有益です。

# Leanをはじめる

Leanで書かれたプログラムを書いて実行する前に、Leanを自分のコンピュータにセットアップする必要があります。
Leanツールは以下から成り立っています：

 * `elan` は、`rustup`や`ghcup`と同様に、Leanコンパイラツールチェーンを管理します。
 * `lake` は、`cargo`、`make`、Gradleと同様に、Leanパッケージとその依存関係をビルドします。
 * `lean` は個々のLeanファイルの型チェックとコンパイルを行うだけでなく、現在書かれているファイルについてプログラマーツールに情報を提供します。
   通常、`lean`はユーザーによって直接ではなく、他のツールによって呼び出されます。
 * Visual Studio CodeやEmacsなどのエディタプラグインは、`lean`と通信して情報を便利に提示します。

Leanのインストールについての最新の説明については、[Leanマニュアル](https://leanprover.github.io/lean4/doc/quickstart.html)を参照してください。

# 約物の規約

Leanに入力されるコードの例はこのようにフォーマットされています：
```lean
{{#example_decl Examples/Intro.lean add1}}

{{#example_in Examples/Intro.lean add1_7}}
```
上記の最後の行（`#eval`で始まる行）は、Leanに答えを計算するよう命令するコマンドです。
Leanの返答はこのようにフォーマットされています：
```output info
{{#example_out Examples/Intro.lean add1_7}}
```
Leanが返すエラーメッセージはこのようにフォーマットされています：
```output error
{{#example_out Examples/Intro.lean add1_string}}
```
警告は、このようにフォーマットされています：
```output warning
declaration uses 'sorry'
```

# ユニコード

慣用的なLeanコードは、ASCIIの一部ではない様々なUnicode文字を使用します。
例えば、この本の第一章で`α`や`β`のギリシャ文字や矢印`→`が出てきます。
これにより、Leanコードは通常の数学的記法により近くなります。

デフォルトのLean設定では、Visual Studio CodeとEmacsの両方でこれらの文字をバックスラッシュ(`\`)に続けて名前を入力することでタイプできます。
例えば、`α`を入力するには`\alpha`とタイプします。
Visual Studio Codeで文字の入力方法を知りたい場合は、マウスでその文字を指し、ツールチップを見てください。
Emacsでは、問題の文字の上で`C-c C-k`を使用します。