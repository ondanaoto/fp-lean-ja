```markdown
# 概要

## 型クラスと構造体

内部的には、型クラスは構造体によって表現されます。
クラスを定義することは構造体を定義することであり、さらにインスタンスの空のテーブルを作成します。
インスタンスを定義すると、構造体をその型として持つ値が作成されるか、あるいは構造体を返すことができる関数が作成され、加えてテーブルに項目が追加されます。
インスタンスの検索は、インスタンステーブルを参照してインスタンスを構築することで行われます。
構造体とクラスは、デフォルト値を提供することができます（これはメソッドのデフォルト実装です）。

## 構造体と継承

構造体は他の構造体から継承することができます。
裏側では、他の構造体から継承する構造体は、もとの構造体のインスタンスをフィールドとして保持しています。
言い換えると、継承は合成によって実装されています。
複数継承が用いられる場合は、ダイヤモンド問題を避けるため設計によって、追加の親構造体からユニークなフィールドのみを使用し、通常ならば親の値を抽出する関数は代わりに一つを構築するように組織されます。
レコードドット表記は構造体の継承を考慮に入れています。

型クラスは単なる構造体であるため、いくつかの追加の自動化が適用されているだけで、これらのすべての機能が型クラスで利用可能です。
デフォルトメソッドと共に、これは大きなクラスが小さいクラスから継承することができる細かい階層のインターフェースを作成するために使用されますが、それはクライアントに大きな負担を課すものではないため、大きなクラスが継承する小さなクラスは自動的に実装可能です。

## アプリカティブファンクター

アプリカティブファンクターは、2つの追加操作を持つファンクターです：
 * `pure`、これは `Monad` のための同じ演算子です
 * `seq`、これはファンクターの文脈内で関数を適用することができます。
  
モナドは任意の制御フローを持つプログラムを表すことができますが、アプリカティブファンクターは関数引数を左から右へと実行することのみができます。
パワーが低いため、インターフェースに対するプログラムの制御は少ない反面、メソッドを実装する側にはより大きな自由度があります。
有用な型は `Applicative` を実装できますが、`Monad` は実装できません。

実際には、型クラス `Functor`、`Applicative`、`Monad` はパワーの階層を形成しています。
階層を昇るにつれて、`Functor` から `Monad` へと、よりパワフルなプログラムを書くことができますが、よりパワフルなクラスを実装する型は少なくなります。
多相的なプログラムは可能なかぎり弱い抽象化を使用して書くべきですが、データ型にはできるだけパワフルなインスタンスを与えるべきです。
これによりコードの再利用が最大化されます。
よりパワフルな型クラスは、より弱いものを拡張するため、`Monad` の実装は `Functor` および `Applicative` の実装を無料で提供します。

それぞれのクラスには実装されるべき一連のメソッドがあり、メソッドに追加のルールを定める対応する契約があります。
これらのインターフェースに対して書かれたプログラムは、追加のルールが守られることを期待しています。もしそれが守られていないならば、プログラムはバグを含む可能性があります。
`Functor` のデフォルト実装と `Applicative` の `Monad` のものは、これらのルールを守るでしょう。

## 宇宙

Leanをプログラミング言語と定理証明者の両方として使用できるようにするために、言語にはいくつかの制約が必要です。
これには、すべての再帰関数が終了するか、あるいは `partial` でマークされていて無人の型を返すように書かれていることを保証する必要があります。
さらに、特定の種類の論理的なパラドックスを型として表現できるようなことが不可能である必要があります。

特定のパラドックスを排除する制約の1つは、すべての型が _宇宙_ に割り当てられているということです。
宇宙は `Prop`、`Type`、`Type 1`、`Type 2` などの型です。
これらの型は他の型を記述します。`0` と `17` が `Nat` によって記述されているように、`Nat` 自体は `Type` によって、そして `Type` は `Type 1` によって記述されています。
型を引数として取る関数の型は、引数の宇宙よりも大きな宇宙でなければなりません。

宣言された各データ型には宇宙がありますが、データのように型を扱うコードを書くとすぐに面倒なことになり、多相型を`Type 1` から取るようにコピー・ペーストする必要が生じます。
_宇宙多相性_ という機能は、Leanのプログラムとデータ型が通常の多相性がプログラムに型を引数として取るのと同じように宇宙レベルを引数として取ることを可能にします。
一般的には、Leanのライブラリは多相的な操作のライブラリを実装する際に宇宙多相性を使用すべきです。
```