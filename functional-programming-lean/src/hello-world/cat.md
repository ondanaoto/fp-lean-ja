# 実例: `cat`

標準的なUnixユーティリティ`cat`は、いくつかのコマンドラインオプションを受け取り、続いてゼロ個以上の入力ファイルを受け取ります。
ファイルが提供されていない場合、またはいずれかがダッシュ（`-`）である場合、ファイルを読み込む代わりに標準入力を対応する入力として受け取ります。
入力の内容は、一つずつ、標準出力に書きだされます。
指定された入力ファイルが存在しない場合、そのことは標準エラーに表示されますが、`cat`は残りの入力の連結を続けます。
どれかの入力ファイルが存在しない場合は、非ゼロの終了コードが返されます。

このセクションでは、`cat`の簡易版である`feline`について説明します。
一般的に使用される`cat`とは異なり、`feline`には行番号を付ける、印刷不可能な文字を示す、ヘルプテキストを表示するなどのコマンドラインオプションはありません。
さらに、端末デバイスに関連付けられている標準入力から複数回読み取ることはできません。

このセクションを最大限活用するには、自分で一緒に行うことをお勧めします。
コード例をコピー＆ペーストするのでも構いませんが、手でタイピングする方がさらに良いでしょう。
これにより、コードをタイピングするプロセスを学び、ミスから回復し、コンパイラーからのフィードバックを解釈することが容易になります。

## 始め方

`feline`を実装する最初のステップは、パッケージを作成し、コードをどのように構成するかを決めることです。
この場合、プログラムが非常にシンプルなため、すべてのコードを`Main.lean`に配置します。
最初のステップは、`lake new feline`を実行することです。
Lakefileを編集してライブラリを削除し、生成されたライブラリコードとその参照を`Main.lean`から削除します。
これが完了すると、`lakefile.lean`は以下を含んでいる必要があります：

```lean
{{#include ../../../examples/feline/1/lakefile.lean}}
```

そして`Main.lean`には以下のような内容が含まれているはずです：
```lean
{{#include ../../../examples/feline/1/Main.lean}}
```
代わりに、`lake new feline exe`を実行することで、ライブラリセクションを含まないテンプレートを`lake`に使わせることができ、ファイルを編集する必要がなくなります。

コードのビルドが可能であることを確認するには、`{{#command {feline/1} {feline/1} {lake build} }}`を実行してください。


## ストリームの連結

プログラムの基本的な骨組みができたので、実際にコードを入力する時が来ました。
正しい`cat`の実装は、`/dev/random`のような無限のIOストリームでも使用できるものです。これは出力する前に入力をメモリに読み込むことはできないことを意味します。
さらに、文字ごとに処理を実行するべきではありません。それはイライラするほど遅いパフォーマンスにつながります。
代わりに、一度に連続するデータブロック全体を読み取り、データを一度に一つのブロックとして標準出力に送信する方がより良いです。